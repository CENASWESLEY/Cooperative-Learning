<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DashBoard Smart Home</title>
     <!--=============== FAVICON ===============-->
     <link rel="shortcut icon" href="assets/Icons/Logo.png" type="image/x-icon">

     <!--==================== fontawesome ====================-->
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
     
     <!--==================== Font ====================-->

     <link rel="preconnect" href="https://fonts.googleapis.com">
     <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
     <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
   
     <!--==================== CSS ====================-->
     <link rel="stylesheet" href="Smarthome.css">

     <!--==================== Chart ====================-->


     <!--==================== Scrollreveal ====================-->
     <script src="https://unpkg.com/scrollreveal"></script>

    <!--==================== MQTT ====================-->
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

    <!--==================== DataTables ====================-->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>

     <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDlEl-DpdzHbHrrz6CF5VzXPpDnm9FxFCQ",
            authDomain: "smart-home-389e5.firebaseapp.com",
            projectId: "smart-home-389e5",
            storageBucket: "smart-home-389e5.appspot.com",
            messagingSenderId: "614600068675",
            appId: "1:614600068675:web:ab428bcdf99382f4c6cef6",
            measurementId: "G-HRDBXFNBTS"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth();

        var uid;
        var email;
        document.addEventListener('DOMContentLoaded', () => {
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    uid = user.uid;
                    email = user.email;
                    console.log("| Current User |");
                    console.log("User Email:", email);
                    console.log("User UID:", uid);
                    // Load user data when the user is signed in
                    loadUserData(email);
                } else {
                    console.log("No user is signed in");
                }
            });
        });

        // Function to load user data from Firestore on page load
        async function loadUserData(email) {
            try {
                const userDoc = await getDoc(doc(db, "Email", email, "users",uid));
                if (userDoc.exists()) {
                    const { name, img } = userDoc.data();
                    const username_main = document.getElementById('main_profile-title-name');
                    const profile_main = document.getElementById('main_profile-picture');

                    if (username_main) username_main.innerText = "Hey, " + name;
                    if (profile_main) profile_main.src = img;
                } else {
                    console.log("No such document!");
                }
            } catch (error) {
                console.error("Error getting document: ", error);
            }
        }
    </script>

</head>
<body>

    <div class="layout">

        <!--==================== header ====================-->

        <section class="header_main">
            <div class="header_iconmenu">

                <div class="header_subiconmenu">

                    <div class="header_logo">

                        <a href="Smarthome.html" id="home">
                            <div class="menu-item menu-itemlogo">
                                <img src="assets/Icons/Logo.png" alt="Home Icon">
                            </div>
                        </a>

                    </div>

                    <div class="vertical-menu">    
                        <a href="Room.html" id="room">
                            <div class="menu-item">
                                <img src="assets/Icons/manage.png" alt="room Icon">
                            </div>
                        </a>
                    </div>


                    <div class="header_user">
                        <a href="User.html" id="user">
                            <div class="menu-item menu-itemuser">
                                <img src="assets/Icons/user.png" alt="Home Icon">
                            </div>
                        </a>
                    </div>

                </div>
            </div>
        </section>

        <!--==================== Title ====================-->

        <section class="section_main-center">

            <main class="title_main">

                    <div class="main_profile">
                        <div class="main_profile-title">
                            <p>Dashboard Smart Home</p>
                            <p class="main_profile-title-name" id="main_profile-title-name">Hey, Username</p>
                        </div>
                    
                        <div class="main_profile-picture" >
                            <img src="assets/images/Avatar.png" id="main_profile-picture" style="width: 120px;" alt="">
                        </div>
                    </div>

                    <div class="main_sensor">
                        <div class="main_sensor-content">

                            <div class="main_sensor-wind">
                                <a href="#"><img class="main_sensor-icon" src="assets/Icons/wind.png" alt=""></a>
                                <div class="main_sensor-wind-detail">
                                    <p class="main_sensor-text">WIND</p>
                                    <h1 class="main_sensor-value" id="wind-value">0.0 m/s</h1>
                                </div>
                            </div>

                            <div class="main_vertical"></div>

                            <div class="main_sensor-temp">
                                <a href="#"><img class="main_sensor-icon" id="temp" src="assets/Icons/temp.png" alt=""></a>
                                <div class="main_sensor-temp-detail">
                                    <p class="main_sensor-text">TEMPERATURE</p>
                                    <h1 class="main_sensor-value" id="temp-value">0.0Â°C</h1>
                                </div>
                            </div>

                            <div class="main_vertical"></div>

                            <div class="main_sensor-humi">
                                <a href="#"><img class="main_sensor-icon" src="assets/Icons/humidity.png" alt=""></a>
                                <div class="main_sensor-humi-detail">
                                    <p class="main_sensor-text">HUMIDITY</p>
                                    <h1 class="main_sensor-value" id="humi-value">0.0%</h1>
                                </div>
                            </div>
                        </div>
                    </div>
                
            </main>

            <main class="favourite_main">
                <div class="favourite_main-title">
                    <p class="favourite_name">CONTROL</p>
                    <P class="favourite_device" id="favourite_device" >0 DEVICES</P>
                </div>

                <div class="favourite_maincard" id="favourite_maincard">

     <!--              
                    <div class="favourite_card">
                        <div class="favorite_card-top">
                            <p class="favourite_card-Room" >Security</p>
                            <p class="favourite_card-name" >DOOR</p>
                        </div>
                        <div class="favorite_card-center">
                            <img src="assets/Icons/door.png" alt="">
                        </div>
                        <div class="favourite_status">
                            <p class="favourite_status-text">LOCK</p>
                            <div class="favourite_switch">
                                <input type="checkbox" id="switch_door-value" class="switch switch_door ">
                                <label for="switch_door-value" class="switch-label"></label>
                            </div>
                        </div>
                    </div>

                    <div class="favourite_card">
                        <div class="favorite_card-top">
                            <p class="favourite_card-Room" >Living Room</p>
                            <p class="favourite_card-name">LIGHT</p>
                        </div>
                        <div class="favorite_card-center">
                            <img src="assets/Icons/lamp.png" alt="">
                        </div>
                        <div class="favourite_status">
                            <p class="favourite_status-text">TURN</p>
                            <div class="favourite_switch">
                                <input type="checkbox" id="switch_light-value" class="switch switch_light ">
                                <label for="switch_light-value" class="switch-label"></label>
                            </div>
                        </div>
                    </div>

                    <div class="favourite_card">
                        <div class="favorite_card-top">
                            <p class="favourite_card-Room">Bed Room</p>
                            <p class="favourite_card-name">POWER</p>
                        </div>
                        <div class="favorite_card-center">
                            <img src="assets/Icons/power.png" alt="">
                        </div>
                        <div class="favourite_status">
                            <p class="favourite_status-text">TURN</p>
                            <div class="favourite_switch">
                                <input type="checkbox" id="switch_power-value" class="switch switch_power">
                                <label for="switch_power-value" class="switch-label"></label>
                            </div>
                        </div>
                    </div>

                    
                    <div class="favourite_card dialog_favourite_card">
                        <div class="favorite_card-top">
                            <p class="favourite_card-Room" >Living Room</p>
                            <p class="favourite_card-name">YEELIGHT LED BULB 1S</p>
                        </div>
                        <div class="favorite_card-center favorite_card-center-yeelight">
                            <img src="assets/images/User/Devices/Yeelight.png" alt="">
                        </div>
                        <div class="favourite_status">
                            <p class="favourite_status-text">TURN</p>
                            <div class="favourite_switch">
                                <input type="checkbox" id="switch_yeelight-value" class="switch switch_yeelight ">
                                <label for="switch_yeelight-value" class="switch-label"></label>
                            </div>
                        </div>
                    </div>
-->


                </div>
            </main>

            <div class="dialog_favourite" id="dialog_favourite">

                <div class="dialog_favourite-content_edit">
                    <div class="dialog_favourite-title_edit">
                        <p>Edit Device</p>
                    </div>
                </div>


                <div class="dialog_favourite-content">
                        <div class="dialog_favourite-title">
                            <p>My Devices</p>
                            <img class="close-button" id="close-button-favourite" src="assets/Icons/close.png" alt=""> 
                        </div>
                        
                        <div class="favourite_maincard dialog_favourite_maincard" id="dialog_favourite_maincard">
                            
                        </div>
                </div>

                <div class="dialog_favourite-content_add">
                    <div class="dialog_favourite-title_add">
                        <p>Add Device</p>
                    </div>

                    <div class="favourite_maincard-AddDevice" id="favourite_maincard-AddDevice">

                        <div class="favourite_card favourite_card-door_adddevice">
                            <div class="favorite_card-top">
                                <p class="favourite_card-Room" >Security</p>
                                <p class="favourite_card-name" >DOOR</p>
                            </div>
                            <div class="favorite_card-center">
                                <img src="assets/Icons/door.png" alt="">
                            </div>
                            <div class="favourite_status">
                                <p class="favourite_status-text">LOCK</p>
                                <div class="favourite_switch">
                                    <input type="checkbox" id="switch_door-value" class="switch switch_door ">
                                    <label for="" class="switch-label"></label>
                                </div>
                            </div>
                        </div>
    
                        <div class="favourite_card favourite_card-light_adddevice">
                            <div class="favorite_card-top">
                                <p class="favourite_card-Room" >Living Room</p>
                                <p class="favourite_card-name">LIGHT</p>
                            </div>
                            <div class="favorite_card-center">
                                <img src="assets/Icons/lamp.png" alt="">
                            </div>
                            <div class="favourite_status">
                                <p class="favourite_status-text">TURN</p>
                                <div class="favourite_switch">
                                    <input type="checkbox" id="switch_light-value" class="switch switch_light ">
                                    <label for="" class="switch-label"></label>
                                </div>
                            </div>
                        </div>
    
                        <div class="favourite_card favourite_card-power_adddevice">
                            <div class="favorite_card-top">
                                <p class="favourite_card-Room">Bed Room</p>
                                <p class="favourite_card-name">POWER</p>
                            </div>
                            <div class="favorite_card-center">
                                <img src="assets/Icons/power.png" alt="">
                            </div>
                            <div class="favourite_status">
                                <p class="favourite_status-text">TURN</p>
                                <div class="favourite_switch">
                                    <input type="checkbox" id="switch_power-value" class="switch switch_power">
                                    <label for="" class="switch-label"></label>
                                </div>
                            </div>
                        </div>
    
                        
                        <div class="favourite_card dialog_favourite_card favourite_card-yeelight_adddevice">
                            <div class="favorite_card-top">
                                <p class="favourite_card-Room">Living Room</p>
                                <p class="favourite_card-name">YEELIGHT LED BULB 1S</p>
                            </div>
                            <div class="favorite_card-center favorite_card-center-yeelight">
                                <img src="assets/images/User/Devices/Yeelight.png" alt="">
                            </div>
                            <div class="favourite_status">
                                <p class="favourite_status-text">TURN</p>
                                <div class="favourite_switch">
                                    <input type="checkbox" id="switch_yeelight-value" class="switch switch_yeelight ">
                                    <label for="" class="switch-label"></label>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            

            </div>
            

            <main class="alert_main">
                <div class="alert_main-title">
                    <p class="alert_name">ALERT</p>
                    <P class="alert_device" id="alert_device">0 DEVICES</P>
                </div>
                    <div class="alert_maincard" id="alert_maincard">
                        <!--
                            <div class="alert_card">
                                <div class="alert_card-top">
                                    <p class="alert_card-Room">Sensor</p>
                                    <p class="alert_card-name">ULTRASONIC</p>
                                </div>

                                <div class="alert_card-center">
                                    <div class="alert_progress-circle " id="ultrasonic">
                                        <div class="progress-circle-inner">
                                        <div class="progress-circle-half left"></div>
                                        <div class="progress-circle-half right">
                                            <div class="progress-circle-half inner"></div>
                                        </div>
                                        <div class="progress-circle-center">
                                            <span class="progress-circle-text" id="ultrasonic-value">0%</span>
                                        </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="alert_card-bottom">
                                    <p>STATUS</p>
                                    <img src="assets/Icons/blackcar.png" alt="">
                                </div>

                            </div>

                        <div class="alert_card">
                            <div class="alert_card-top">
                                <p class="alert_card-Room">Sensor</p>
                                <p class="alert_card-name">WATER LEVEL</p>
                            </div>
                            
                            <div class="alert_card-center">
                                <div class="alert_progress-circle" id="water-level">
                                    <div class="progress-circle-inner">
                                      <div class="progress-circle-half left"></div>
                                      <div class="progress-circle-half right">
                                        <div class="progress-circle-half inner"></div>
                                      </div>
                                      <div class="progress-circle-center">
                                        <span class="progress-circle-text" id="water-level-value">0%</span>
                                      </div>
                                    </div>
                                  </div>
                            </div>

                            <div class="alert_card-bottom">
                                <p>Level</p>
                                <img src="assets/Icons/lowwater.png" alt="">
                            </div>

                        </div>

                    <div class="alert_card">
                        <div class="alert_card-top">
                            <p class="alert_card-Room">Sensor</p>
                            <p class="alert_card-name">PUMP</p>
                        </div>

                        <div class="alert_card-center">
                            <div class="alert_progress-circle" id="pump">
                                <div class="progress-circle-inner">
                                  <div class="progress-circle-half left"></div>
                                  <div class="progress-circle-half right">
                                    <div class="progress-circle-half inner"></div>
                                  </div>
                                  <div class="progress-circle-center">
                                    <span class="progress-circle-text" id="pump-value">0%</span>
                                  </div>
                                </div>
                              </div>
                        </div>

                        <div class="alert_card-bottom">
                            <p>STATUS</p>
                            <img src="assets/Icons/blackgauge.png" alt="">
                        </div>

                    </div>

                    
                    
                </div>
            -->
            </main>

    </Section>

    <section class="external_main">

        <div class="external_title">
            <p class="external_name">EXTERNAL</p>
            <P class="external_device">2 DEVICES</P>
        </div>

        <div class="external_multi_submain">

            <div class="external_submain-home_charger">
                <div class="external_head">
                    <div class="external_headtext">
                        <p class="external_card-Room">Home Charger</p>
                        <p class="external_card-name">MEA EV HOME CHARGER</p>
                    </div>
                    <div class="external_card-img">
                        <img src="assets/images/User/Devices/home_charger.png" class="home_charger" alt="">
                    </div>
                </div>
                <div class="external_maincard-clock">
                    <div class="external_card-clock">
                        <p>CLOCK TIMER</p>
                        <div class="external_clock-date">
                            <span id="month">July</span>,
                            <span id="day">Thursday</span>
                            <span id="date">21</span>
                            <span id="year">2024</span>
                        </div>
                        <div class="external_clock-timer">
                            <p id="hour">12</p>
                            <p id="dots">:</p>
                            <p id="min">30</p>
                            <div class="external_clock_subtimer">
                                <p id="period">AM</p>
                                <p id="sec">00</p>
                            </div>
                        </div>
                        <div class="external_card-clock-day">
                            <p id="mon">MON</p>
                            <p id="tue">TUE</p>
                            <p id="wed">WED</p>
                            <p id="thu">THU</p>
                            <p id="fri">FRI</p>
                            <p id="sat">SAT</p>
                            <p id="sun">SUN</p>
                        </div>
                        
                        <div class="external_clock-none"></div>
                    </div>
    
                    <div class="external_card_session">
                        <p>SESSION TIME</p>
                        <div class="external_energy">
                            <p>Energy : </p>
                            <p id="session_energy-home_charger">0</p>
                            <p>KWH</p>
                        </div>
                        <div class="external_clock-session">
                            <p id="hour-session">00</p>
                            <p id="dots-session">:</p>
                            <p id="min-session">00</p>
                            <p id="dots-session">:</p>
                            <p id="sec-session">00</p>
                        </div>

                        <div class="external_card_transaction">
                            <div class="start_transaction" id="start_transaction" onclick="startTransaction()">
                                <i class="fa-solid fa-play"></i>
                                <div class="start_transaction-text transaction-text">
                                    <p>Start</p>
                                    <p>transaction</p>
                                </div>
                            </div>
                            <div class="stop_transaction" id="stop_transaction" onclick="stopTransaction()">
                                <i class="fa-solid fa-stop"></i>
                                <div class="stop_transaction-text transaction-text">
                                    <p>Stop</p>
                                    <p>transaction</p>
                                </div>
                            </div>
                            <span id="start-time"></span>
                            <span id="end-time"></span>
                            


                        </div>
                    </div>
                </div>

                <div class="external_maincard-detail-home_charger">
                    <div class="external_card-detail-home_charger">
                        <p class="external_card-name-home_charger">VOLTAGE</p>
                        <p class="external_card-value-home_charger" id="volt-home_charger">0.00</p>
                        <p class="external_card-uni-home_charger">V</p>
                    </div>
                    <div class="external_card-detail-home_charger">
                        <p class="external_card-name-home_charger">CURRENT</p>
                        <p class="external_card-value-home_charger" id="current-home_charger">0.00</p>
                        <p class="external_card-uni-home_charger">A</p>
                    </div>
                    <div class="external_card-detail-home_charger">
                        <p class="external_card-name-home_charger">POWER</p>
                        <p class="external_card-value-home_charger" id="power-home_charger">0.00</p>
                        <p class="external_card-uni-home_charger">KW</p>
                    </div>
                    <div class="external_card-detail-home_charger">
                        <p class="external_card-name-home_charger">ENERGY</p>
                        <p class="external_card-value-home_charger" id="energy-home_charger">0.00</p>
                        <p class="external_card-uni-home_charger">KWH</p>
                    </div>

                </div>

                

                <div class="chart_multipages" id="chart_multipages">

                    <div class="chart-container-home_charger page1 active_page">
                        <canvas class="chart-home_charger" id="home_charger"></canvas>
                    </div>

                    <div class="history_chart-container-home_charger page2">
                        <table id="history-home_charger" class="history-home_charger">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Start Time</th>
                                    <th>End Time</th>
                                    <th>Charging Duration</th>
                                    <th>Energy Consumed (kWh)</th>
                                    <th>Cost</th>
                                    <th>Charging Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- ==
                                <tr>
                                    <td>15-07-2024</td>
                                    <td>08:00</td>
                                    <td>10:00</td>
                                    <td>2 hours</td>
                                    <td>20 kWh</td>
                                    <td>$5.00</td>
                                    <td>Completed</td>
                                </tr>
 
                                -->
                            </tbody>
                        </table>
                    </div>

                    <div class="page3"></div>

                    <div class="chart_multipages-dot">
                        <div class="dot_page dot_page1 highlight_page"></div>
                        <div class="dot_page dot_page2"></div>
                    </div>

                </div>

                
                
            </div>

            <div class="external_submain" >
                <div class="external_head">
                    <div class="external_headtext">
                        <p class="external_card-Room">Sensor</p>
                        <p class="external_card-name">METER</p>
                    </div>
                    <div class="external_card-img">
                        <img src="assets/Icons/meter.png" alt="">
                    </div>
                </div>

                <div class="external_maincard-detail">
                    <div class="external_card-detail">
                        <p class="external_card-name">VOLTAGE</p>
                        <p class="external_card-value" id="volt">0.00</p>
                        <p class="external_card-unit">V</p>
                    </div>
                    <div class="external_card-detail">
                        <p class="external_card-name">CURRENT</p>
                        <p class="external_card-value" id="current">0.00</p>
                        <p class="external_card-unit">A</p>
                    </div>
                    <div class="external_card-detail">
                        <p class="external_card-name">ACTIVE POWER</p>
                        <p class="external_card-value" id="active_power">0.00</p>
                        <p class="external_card-unit">W</p>
                    </div>
                    <div class="external_card-detail">
                        <p class="external_card-name">REACTIVE POWER</p>
                        <p class="external_card-value" id="reactive_power">0.00</p>
                        <p class="external_card-unit">VAR</p>
                    </div>
                    <div class="external_card-detail">
                        <p class="external_card-name">POWER FACTOR</p>
                        <p class="external_card-value" id="power_factor">0.00</p>
                        <p class="external_card-unit" style="opacity: 0;">PF</p>
                    </div>
                    <div class="external_card-detail">
                        <p class="external_card-name">FREQUENCY</p>
                        <p class="external_card-value" id="frequency">0.00</p>
                        <p class="external_card-unit">HZ</p>
                    </div>

                </div>
                
                <div class="chart-container-meter">
                    <canvas class="chart-meter" id="chart-meter"></canvas>
                </div>

                
            </div>


    </div>



    </section>


</div>

    <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
    <script type="module" src="MQTT.js"></script>
    <script type="module" src="Smarthome_Device_Management.js"></script>
    <script type="module" src="Smarthome.js"></script>
    <script src="HTTP.js"></script>
    <script src="https://unpkg.com/scrollreveal@4.0.0/dist/scrollreveal.min.js"></script>    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-streaming@2.0.0/dist/chartjs-plugin-streaming.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    

</body>
</html>